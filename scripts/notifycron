#!/bin/bash

for user_dir in /home/users/*; do
    user=$(basename "$user_dir")
    notif_file="$user_dir/notifications.log"

    # Skip if file doesn't exist
    [[ -f "$notif_file" ]] || continue

    # Check if user has new notifications
    if grep -q '^new_notifs$' "$notif_file"; then
        notif_count=$(tail -n +2 "$notif_file" | wc -l)
        if (( notif_count > 0 )); then
            message="You have $notif_count new blog notification(s). Run '~/view_notifs' to read."
            su - "$user" -c "wall '$message'" 2>/dev/null
        fi
    fi
done
